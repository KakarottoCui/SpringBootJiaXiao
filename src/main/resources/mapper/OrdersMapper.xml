<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.singulee.carschool.pojo.OrdersMapper">
    <resultMap id="BaseResultMap" type="com.singulee.carschool.pojo.Orders">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="ordId" jdbcType="INTEGER" property="ordid"/>
        <result column="detailId" jdbcType="INTEGER" property="detailid"/>
        <result column="stuId" jdbcType="INTEGER" property="stuid"/>
        <result column="logDate" jdbcType="TIMESTAMP" property="logdate"/>
        <result column="states" jdbcType="INTEGER" property="states"/>
        <result column="grade" jdbcType="INTEGER" property="grade"/>
        <result column="log" jdbcType="VARCHAR" property="log"/>
        <result column="extend1" jdbcType="TIMESTAMP" property="extend1"/>
    </resultMap>
    <sql id="Base_Column_List">

    ordId, detailId, stuId, logDate, states, grade, log, extend1
  </sql>

    <!--查看我的课程记录课程 后期使用真分页 courseDate:(课程日期) states (预定状态) courseClass (课程类型) stuId-->
    <!--<select id="getMyHistory" parameterType="java.util.Map" resultType="java.util.Map">-->
    <!--select *  from orders  o,detail d where d.detailId=o.detailId-->
    <!--and o.stuId=#{studentId}-->
    <!--<if test="courseDate!=null and courseDate!=''">-->
    <!--and d.courseDate &gt;=#{courseDate}-->
    <!--</if>-->
    <!--<if test="courseClass!=null and courseClass!=''">-->
    <!--and d.extend1=#{courseClass}-->
    <!--</if>-->
    <!--<if test="states!=null and states!=''">-->
    <!--and o.states=#{states}  -->
    <!--</if>-->
    <!--</select>-->

    <select id="getMyOrderDate" resultType="java.util.Map" parameterType="java.util.Map">
        select o.ordId
        from orders o,detail d
        where
       d.detailId = o.detailId
         and o.states='0'
        <if test="studentId!=null and studentId!=''">
            and o.stuId=#{studentId}
            <if test="courseDate !=null and courseDate!=''">
                and d.courseDate=#{courseDate}
            </if>
            group by ordId
        </if>



    </select>

    <!--查看我的预约课程  courseClass  courseDate  studentId teacherId  stautes(0 预约 1 取消  不限)-->
    <select id="getMyOrder" resultType="java.util.Map" parameterType="java.util.Map">
        select o.ordId,o.logDate,o.states,o.grade,o.log,ca.carNumber, t.teaName, t.teaPhone,
        c.courseBegin,courseEnd,d.extend1,d.courseDate,
        d.detailId,o.extend1 as ordertime,
        s.stuId,s.stuName ,s.stuPhone,s.stuSex,s.stuStust
        from orders o,detail d,course c ,relationship r,teacher t ,cart ca,student s
        where ca.carId=r.cartId and r.teacherId=t.teaId and r.relationshipId =d.relationshipId
        and d.courseId =c.courseId and d.detailId = o.detailId
        <if test="courseClass!=null and courseClass!=''">
            and d.extend1=#{courseClass}
        </if>
        <if test="stautes!=null and stautes!=''">
            <choose>
                <when test="stautes==0">
                    and o.states=0
                </when>
                <when test="stautes==1">
                    and o.states=1
                </when>
            </choose>
        </if>
        <if test="orderId!=null and orderId!=''">
            and o.ordId=#{orderId} group by ordId
        </if>
        <if test="studentId!=null and studentId!=''">

            and o.stuId=#{studentId}
            <if test="courseDate !=null and courseDate!=''">
                and d.courseDate =#{courseDate}
            </if>
            group by ordId
        </if>
        <if test="teacherId!=null and teacherId!=''">
            and o.stuId =s.stuId
            and t.teaId=#{teacherId}
            <if test="courseDate !=null and courseDate!=''">
                and d.courseDate =#{courseDate}
            </if>
            group by o.detailId
        </if>


    </select>


    <select id="selectById" parameterType="java.lang.Integer" resultType="com.singulee.carschool.pojo.Orders">
    select 
    *
    from orders
    where ordId = #{ordid,jdbcType=INTEGER}
  </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">

    delete from orders
    where ordId = #{ordid,jdbcType=INTEGER}
  </delete>
    <!--预定课程-->
    <insert id="insert" parameterType="com.singulee.carschool.pojo.Orders">
    insert into orders (ordId, detailId, stuId, 
      logDate, states, grade, 
      log, extend1)
    values (#{ordid,jdbcType=INTEGER}, #{detailid,jdbcType=INTEGER}, #{stuid,jdbcType=INTEGER}, 
      #{logdate,jdbcType=TIMESTAMP}, #{states,jdbcType=INTEGER}, #{grade,jdbcType=INTEGER}, 
      #{log,jdbcType=VARCHAR}, #{extend1,jdbcType=TIMESTAMP})
  </insert>


    <select id="getGreadList" resultType="java.util.Map" parameterType="java.util.Map">
        select o.grade as gread,d.courseDate as coursedate from orders o,detail d where d.detailId=o.detailId and
        o.stuId=#{studentId}
        and d.extend1=#{courseTyep} and o.logDate is not null
        <choose>
            <when test="type==7">
                and d.courseDate&gt;=#{date} and d.courseDate&lt;=date_add(str_to_date(#{date} , '%Y-%m-%d'), interval 1
                week )

            </when>
            <when test="type==30">
                and d.courseDate&gt;=#{date} and d.courseDate&lt;=date_add(str_to_date(#{date} , '%Y-%m-%d'), interval 1
                month )
            </when>
        </choose>
        group by ordId order by d.courseDate


    </select>

    <insert id="insertByNull" parameterType="com.singulee.carschool.pojo.Orders">
        insert into orders
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="detailid != null">
                detailId,
            </if>
            <if test="stuid != null">
                stuId,
            </if>
            <if test="logdate != null">
                logDate,
            </if>
            <if test="states != null">
                states,
            </if>
            <if test="grade != null">
                grade,
            </if>
            <if test="log != null">
                log,
            </if>
            <if test="extend1 != null">
                extend1,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="detailid != null">
                #{detailid,jdbcType=INTEGER},
            </if>
            <if test="stuid != null">
                #{stuid,jdbcType=INTEGER},
            </if>
            <if test="logdate != null">
                #{logdate,jdbcType=TIMESTAMP},
            </if>
            <if test="states != null">
                #{states,jdbcType=INTEGER},
            </if>
            <if test="grade != null">
                #{grade,jdbcType=INTEGER},
            </if>
            <if test="log != null">
                #{log,jdbcType=VARCHAR},
            </if>
            <if test="extend1 != null">
                #{extend1,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.singulee.carschool.pojo.Orders">
        update orders
        <set>
            <if test="detailid != null">
                detailId = #{detailid,jdbcType=INTEGER},
            </if>
            <if test="stuid != null">
                stuId = #{stuid,jdbcType=INTEGER},
            </if>
            <if test="logdate != null">
                logDate = #{logdate,jdbcType=TIMESTAMP},
            </if>
            <if test="states != null">
                states = #{states,jdbcType=INTEGER},
            </if>
            <if test="grade != null">
                grade = #{grade,jdbcType=INTEGER},
            </if>
            <if test="log != null">
                log = #{log,jdbcType=VARCHAR},
            </if>
            <if test="extend1 != null">
                extend1 = #{extend1,jdbcType=VARCHAR},
            </if>
        </set>
        where ordId = #{ordid,jdbcType=INTEGER}
    </update>

    <!--修改预定信息-->
    <update id="update" parameterType="com.singulee.carschool.pojo.Orders">
    update orders
    set detailId = #{detailid,jdbcType=INTEGER},
      stuId = #{stuid,jdbcType=INTEGER},
      logDate = #{logdate,jdbcType=TIMESTAMP},
      states = #{states,jdbcType=INTEGER},
      grade = #{grade,jdbcType=INTEGER},
      log = #{log,jdbcType=VARCHAR},
      extend1 = #{extend1,jdbcType=VARCHAR}
    where ordId = #{ordid,jdbcType=INTEGER}
  </update>
</mapper>